# ============================================================================
# RETRY TEST WORKFLOW
# ============================================================================
# Tests retry behavior with a flaky handler that fails randomly.
# With failure_rate=0.5 and max_attempts=5, probability of all attempts
# failing = 0.5^6 = 1.6% (very likely to succeed).
#
# Submit with:
#   python tools/submit_job.py retry_test '{"failure_rate": 0.5}'
# ============================================================================

workflow_id: retry_test
name: Retry Test
version: 1
description: Tests retry behavior with flaky handler

inputs:
  failure_rate:
    type: number
    required: false
    default: 0.5

nodes:
  start:
    type: start
    next: flaky_step

  flaky_step:
    type: task
    handler: flaky_echo
    params:
      failure_rate: "{{ inputs.failure_rate }}"
      message: "I might fail"
    retry:
      max_attempts: 5
      backoff: fixed
      initial_delay_seconds: 1
    timeout_seconds: 30
    next: end

  end:
    type: end
